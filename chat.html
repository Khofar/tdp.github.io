<!DOCTYPE html>
<html>

<head>
  <title>Khofar Comments</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css" />
  <style>
    :root {
      --bg: #0d0d0d;
      --text: #fff;
      --card: #1a1a1a;
      --input: #2c2c2c;
      --accent: #00ff88;
      --timestamp: #aaa;
    }
    
    #name,
    #message {
      
      color: #EE00EE;
      font-weight: bold;
      text-shadow:
        0 0 1px yellow,
        0 0 2px yellow,
        0 0 3px yellow;
      box-shadow:
        0 0 5px lightseagreen,
        0 0 10px lightseagreen;
    }
    
    body.light {
      --bg: #f5f5f5;
      --text: #111;
      --card: #fff;
      --input: #eee;
      --accent: #0077ff;
      --timestamp: #444;
    }
    
    body {
      width: 350px;
      margin: 0;
      padding: 20px;
      font-family: "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }
    
    #galaxy-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
      background: #000;
    }
    
    .toggle-theme {
      position: fixed;
      top: 15px;
      right: 15px;
      background: var(--card);
      border: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      font-size: 20px;
      color: var(--accent);
      cursor: pointer;
      z-index: 9999;
      box-shadow: 0 0 8px var(--accent);
    }
    
    h2 {
      text-align: center;
      font-size: 24px;
      margin-bottom: 30px;
      color: #FF10B5;
    }
    
    .text1-shadow {
      0 0 5px navajowhite,
      0 0 10px navajowhite,
      0 0 15px navajowhite;
      animation: pulseglow 1s infinite alternate;
      backdrop-filter: blur(10px);
    }
    
    @keyframes pulseglow {
      from {
        text-shadow:
          0 0 5px navajowhite,
          0 0 10px navajowhite,
          0 0 15px navajowhite;
      }
      
      to {
        text-shadow:
          0 0 10px navajowhite,
          0 0 20px navajowhite,
          0 0 30px navajowhite;
      }
    }
    
    /*here khofar*/
    form {
      width: 100%;
      max-width: 100%;
      margin: 0 auto 40px auto;
      background: var(--card);
      padding: 20px;
      border-radius: 12px;
      box-shadow:
        0 0 5px red,
        0 0 10px red,
        0 0 15px red;
      animation: box1pulse 1s infinite alternate;
      backdrop-filter: blur(10px);
    }
    
    @keyframes box1pulse {
      from {
        box-shadow:
          0 0 5px red,
          0 0 10px red,
          0 0 15px red;
      }
      
      to {
        box-shadow:
          0 0 10px red,
          0 0 20px red,
          0 0 30px red;
      }
    }
    
    input,
    textarea {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      margin-top: 10px;
      margin-bottom: 15px;
      background: var(--input);
      color: var(--text);
      width: 100%;
      box-sizing: border-box;
      box-shadow: 0 0 10px red;
    }
    
    button {
      width: 100%;
      padding: 14px;
      background: var(--accent);
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      color: #000;
      cursor: pointer;
      transition: 0.3s;
    }
    
    button:hover {
      opacity: 0.9;
      transform: scale(1.02);
    }
    
    #emojiBar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 24px;
      user-select: none;
      margin: 10px 0;
      box-shadow:
        0 0 5px lightseagreen,
        0 0 10px lightseagreen;
      border-radius: 10px;
    }
    
    .emoji {
      cursor: pointer;
      transition: 0.2s;
      filter: drop-shadow(0 0 1px white)
      drop-shadow(0 0 3px white);
      
    }
    
    .emoji:hover {
      transform: scale(1.2);
    }
    
    #commentsList {
      margin-top: 30px;
    }
    
    .comment {
      background: var(--card);
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 10px;
      border-left: 4px solid var(--accent);
      animation: fadeIn 0.4s ease;
    }
    
    .comment strong {
      color: var(--accent);
      display: block;
      margin-bottom: 5px;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .chat-html h2 {
      filter: drop-shadow(0 0 3px blue) drop-shadow(0 0 6px blue);
    }
  </style>
  
</head>

<body class="chat-html">
  
  <canvas id="galaxy-bg"></canvas>
  
  <div class="menu-wrapper">
    <div id="hamburger" class="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <nav class="menu-links" id="menuLinks">
      <a href="index.html">Home 🏠</a>
      <a href="table.html">Players 🧍</a>
      <a href="gallery.html">Gallery 📷</a>
      <a href="about.html">About ℹ️</a>
      <a href="contact.html">Contact 📧</a>
      <a href="chat.html">Chatting 💬</a>
      <a href="event.html">EVENTS 🎪</a>
      <a href="crown.html">Crown 👑</a>
    </nav>
  </div>
  
  <button class="toggle-theme" id="themeToggle">☀️</button>
  <h2>💬 Leave a Comment</h2>
  
  <form id="commentForm">
    <input type="text" id="name" placeholder="Your name" required>
    <div id="emojiBar">
      <span class="emoji">🔥</span>
      <span class="emoji">😂</span>
      <span class="emoji">😭</span>
      <span class="emoji">💀</span>
      <span class="emoji">💯</span>
      <span class="emoji">😎</span>
      <span class="emoji">🤯</span>
      <span class="emoji">👀</span>
      <span class="emoji">❤️</span>
      <span class="emoji">👙</span>
    </div>
    <textarea id="message" placeholder="Write something..." required></textarea>
    <button type="submit" class="text1-shadow box-effect" style="display: block; margin: 20px auto;">👉Post Comment👈</button>
  </form>
  
  <div id="commentsList"></div>
  
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      query,
      orderBy,
      onSnapshot,
      deleteDoc,
      doc
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
    
    const firebaseConfig = {
      apiKey: "AIzaSyCMw6LUtfaYFh8-wvkT54yDykieav7naV8",
      authDomain: "khofar-site-comments.firebaseapp.com",
      projectId: "khofar-site-comments",
      storageBucket: "khofar-site-comments.appspot.com",
      messagingSenderId: "853499937990",
      appId: "1:853499937990:web:d6150ffaa6c0b8b10b83c7"
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const commentsRef = collection(db, "comments");
    
    const form = document.getElementById("commentForm");
    const commentsList = document.getElementById("commentsList");
    
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value.trim();
      const message = document.getElementById("message").value.trim();
      if (!name || !message) return;
      await addDoc(commentsRef, {
        name,
        message,
        timestamp: new Date()
      });
      form.reset();
    });
    
    function showDelete(commentElement, commentId) {
      if (commentElement.querySelector(".delete-btn")) return;
      const del = document.createElement("button");
      del.textContent = "❌ Delete";
      del.className = "delete-btn";
      del.style = `
        margin-top:10px;
        padding:8px;
        background:red;
        color:#fff;
        border:none;
        border-radius:6px;
        width: 100px;
        display: block;
      `;
      del.onclick = async () => {
        try {
          await deleteDoc(doc(db, "comments", commentId));
        } catch (err) {
          alert("Delete failed. Check Firebase rules.");
        }
      };
      commentElement.appendChild(del);
    }
    
    const q = query(commentsRef, orderBy("timestamp", "desc"));
    
    onSnapshot(q, (snapshot) => {
      commentsList.innerHTML = "";
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const id = docSnap.id;
        
        const comment = document.createElement("div");
        comment.classList.add("comment");
        
        const dateObj = data.timestamp?.toDate();
        const timeText = dateObj ?
          new Intl.DateTimeFormat('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: 'numeric',
            minute: '2-digit',
            hour12: true
          }).format(dateObj) :
          '';
        
        comment.innerHTML = `
          <strong>${data.name}</strong>
          <p>${data.message}</p>
          <small style="opacity:0.6;display:block;margin-top:5px;">🕒 ${timeText}</small>
        `;
        
        let pressTimer;
        
        comment.addEventListener("touchstart", () => {
          pressTimer = setTimeout(() => showDelete(comment, id), 700);
        });
        comment.addEventListener("touchend", () => clearTimeout(pressTimer));
        comment.addEventListener("touchmove", () => clearTimeout(pressTimer));
        comment.addEventListener("contextmenu", (e) => {
          e.preventDefault();
          showDelete(comment, id);
        });
        
        commentsList.appendChild(comment);
      });
    });
  </script>
  
  <script>
    // Emoji insert logic
    const emojiBar = document.getElementById("emojiBar");
    const messageInput = document.getElementById("message");
    
    emojiBar.addEventListener("click", (e) => {
      if (e.target.classList.contains("emoji")) {
        const emoji = e.target.textContent;
        const start = messageInput.selectionStart;
        const end = messageInput.selectionEnd;
        const text = messageInput.value;
        messageInput.value = text.slice(0, start) + emoji + text.slice(end);
        messageInput.focus();
        messageInput.selectionStart = messageInput.selectionEnd = start + emoji.length;
      }
    });
  </script>
  
  <script>
    // Theme toggle
    const toggleBtn = document.getElementById('themeToggle');
    const body = document.body;
    
    function setTheme(mode) {
      body.classList.toggle('light', mode === 'light');
      localStorage.setItem('theme', mode);
      toggleBtn.textContent = mode === 'light' ? '🌙' : '☀️';
    }
    
    toggleBtn.addEventListener('click', () => {
      const current = body.classList.contains('light') ? 'dark' : 'light';
      setTheme(current);
    });
    
    const saved = localStorage.getItem('theme') || 'dark';
    setTheme(saved);
  </script>
  <script src="script.js"></script>
  <script src="stars.js"></script>
</body>

</html>